<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
<ModulePrefs title="State Example" height="120">
  <Require feature="wave" /> 
</ModulePrefs>
<Content type="html">
<![CDATA[ 
<div id="content_div" class="dayfindr_month" style="height: 50px;"></div>

    <link rel="stylesheet" href="http://github.com/bjnortier/dayfindr_wave/raw/introduce_moustache/style.css" type="text/css" charset="utf-8"/>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js"></script>
    <script src="http://github.com/janl/mustache.js/raw/0b2dcc5531cf8fe9d247f1533348cd62d44d7f9e/mustache.js"></script>
    <script src="http://github.com/bjnortier/dayfindr_wave/raw/introduce_moustache/dayfindr_wave.js"></script>
    <script type="text/javascript">

    var div = document.getElementById('content_div');


    function getNextYearAndMonth(year, month) {
      var yearAndMonth = [];
      if (month == 12) {
        yearAndMonth[0] = year + 1;
	yearAndMonth[1] = 1;
      } else {
        yearAndMonth[0] = year;
	yearAndMonth[1] = month + 1;
      }
      return yearAndMonth;
    }

    function stateUpdated() {

       var today = new Date();
       year = today.getFullYear();
       month = today.getMonth();
       
       var templates = [];
       var yearsAndMonths = [];
       for (var i = 0; i < 12; ++i) {
            templates[i] = createMonthTemplate(year, month);

            var nextYearAndMonth = getNextYearAndMonth(year, month);
	    year = nextYearAndMonth[0];
	    month = nextYearAndMonth[1];
            yearsAndMonths.push([year, month]);
       }

       var view = viewFromState(yearsAndMonths, wave);

       var html = '';
       for (var i = 0; i < templates.length; ++i) {
         html += Mustache.to_html(templates[i], view);
       }
       div.innerHTML = html;

    }
 
    function init() {
      if (wave && wave.isInWaveContainer()) {
        wave.setStateCallback(stateUpdated);
      }
    }
    gadgets.util.registerOnLoadHandler(init);

 
    </script>
 
  ]]> 
  </Content>
</Module>